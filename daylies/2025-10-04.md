# 2025-10-04

Instructions:
 * For each step, create a git branch, write all relevant code, and then pause to let me do testing and debugging. Once I say things are OK, squash the branch and merge it into main. Then repeat the actions in this instruction for the next step. Repeat until all steps are complete.

## Step 1

Create and switch to Branch: feature/add-monetary-info-device

Let's move the monetary information into it's own device. The device should be named "Enphase Monetary <site id>". Savings Imported Today and Savings Exported Today should be moved into that device.

There should be an option for the user to enable or disable that device.

## Step 2

Create and switch to Branch: feature/add-vpp-device

Let's move the VPP Information to its own device. The device should be named "Enphase VPP <site id> <program id>". VPP Event Today, VPP Events Calendar, and VPP Events should be moved into that device.

There should be an option for the user to enable or disable that device.

## Step 3

Create and switch to Branch: feature/add-import-costs

We will add two sensors to the Enphase Monetary device:
 1. An "Import Cost Now" number that will always show how much an import costs at this moment.
 2. An "Import Cost Calendar" which will show the import cost for all time periods for the next week.

Import Cost data is available from: `https://enlighten.enphaseenergy.com/service/tariff/tariff-ms/systems/<site id>/tariff?include-site-details=true`

A sample of the json output for that input call is available in the file `Enphase API/import_tariff.md`

For both the Import Cost Now and the Import Cost Calendar events, please include the `rateComponents` as properties of the data. Use the `rate` as the value for the sensor.

## Step 4

Create and switch to Branch: feature/add-export-prices

We will add two sensors to the Enphase Monetary device:
 1. an "Export Cost Now" number that will always show how much we are credited for an export at this moment.
 2. An "Export Credit Calendar" which will show all export prices for all time periods for the next week.

Export Credit data is available from: `https://enlighten.enphaseenergy.com/service/tariff/tariff-ms/systems/<site id>/tariffs?rateType=BUYBACK&date=<date as YYYY-MM-DD>&includeUtility=`

A sample of the json output is available in the file `Enphase API/export_tariff.md`

Start and End times are in minutes from midnight of that day. Use the Rate for the value of the sensor.

## Step 5

Create and switch to Branch: feature/add-current-vpp-info

Let's add a sensors to the VPP Device:
 1. A sensor that shows the count of VPP events today. (if there are none, show 0)
 2. A sensor that shows the starting timestamp of the next VPP event, or "None"
 3. A sensor that shows the event type of the next VPP event, or "None"
 4. A sensor that shows the count of all future VPP events. (If there are none, show 0)